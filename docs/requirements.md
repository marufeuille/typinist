# Typinist - 要件定義書

## プロジェクト概要

**プロジェクト名:** Typinist
**対象年齢:** 小学生（8〜9歳）
**目的:** ローマ字タイピング練習 × プログラミング的思考の導入

### 背景
Scratchの手前の段階として、ローマ字タイピング練習を主目的とするWebアプリ。キャラクターへの指示をローマ字で打つことで、タイピング練習とプログラミング的思考を自然に体験できる体験を提供する。

---

## ターゲットユーザー・開発思想

- **主対象:** 小学3〜4年生（8〜9歳）
- **前提スキル:** ひらがな読み書き可能、ローマ字の基本を学習中
- **開発思想:**
  - 「楽しい」を最優先：ゲーム感覚でタイピングを練習
  - 「わかりやすい」：直感的なUI、難しい漢字を使わない
  - 「達成感がある」：ゴール到達のクリア演出
  - ScratchとなぞりBOTの間のポジション

---

## 機能要件

### 段階的設計（Step別）

#### Step 1（MVP）- ゴール誘導モード
- グリッド上のキャラクターをローマ字コマンドで操作
- 3つのコマンド：まえにすすむ、みぎをむく、ひだりをむく
- 5x5グリッド（固定）
- コマンドパレットからコマンドを選択してタイピング
- ゴール到達でクリア表示

#### Step 2（実装済み）- 障害物・アイテム・扉・難易度設定
- 障害物を追加してルートを複雑化
- アイテム（鍵など）取得システム（インベントリ）
- コンテキストコマンド：「ひろう」「とびらをひらく」
- 難易度設定（やさしい / 地獄）でコマンド表示を制御
- 新ステージ（Stage 6〜8）追加

#### Step 3（将来）- 2モード実装
- モードA（お絵かき）：ペン軌跡でお題の絵を描く
- ペンコマンド追加：ペンをあげる/おろす、ペンのいろをかえる

#### Step 4（将来）- 自然言語入力
- ダミーLLMによるキーワードマッチング
- より自然な日本語での指示入力

#### Step 5（将来）- 強化UI
- ローマ字ヒントUI
- タイピング統計（打鍵数・正答率）
- キャラクターイラスト差し替え

### 2つの入力モード
1. **写経モード（Lv.1）:** 推奨コマンド順序が提示され、そのまま打つ
2. **自由モード（Lv.2+）:** コマンドパレットから自分で選択して打つ

### ローマ字タイピング仕様
- 1文字ずつリアルタイム判定
- 正解キー：緑ハイライト
- 不正解キー：赤フラッシュ（ペナルティなし）
- 複数入力パターン対応：
  - 「し」→ "si" or "shi"
  - 「つ」→ "tu" or "tsu"
  - 「ち」→ "ti" or "chi"
  - 「っ」→ 子音の重ね打ち対応

### コマンド体系（Step 2）

#### 基本コマンド（全ステージ）

| コマンド | 日本語 | ローマ字 | アクション |
|---|---|---|---|
| まえにすすむ | 前に1マス進む | maenisusuumu | 現在の向きの方向に1マス移動 |
| みぎをむく | 右を向く | migiwomuku | 時計回りに90°回転 |
| ひだりをむく | 左を向く | hidariwomuku | 反時計回りに90°回転 |

#### コンテキストコマンド（条件付き）

| コマンド | 日本語 | ローマ字 | 発動条件 | アクション |
|---|---|---|---|---|
| ひろう | アイテムを拾う | hirou | 現在地にアイテムがある | インベントリに追加 |
| とびらをひらく | 扉を開ける | tobiraohiraku | 前方に未開の扉があり必要アイテム所持 | 扉を開錠 |

### 難易度設定

| モード | 名前 | コンテキストコマンドの表示 |
|---|---|---|
| easy | やさしい | 常時表示（条件未達成時はグレーアウト） |
| hard | じごく | 条件達成時のみ表示（ヒントなし） |

### アイテム・インベントリシステム
- マップ上にアイテム（鍵など）を配置可能
- キャラクターが同じマスに立ち「ひろう」を実行すると取得
- 取得済みアイテムはインベントリで管理（ID文字列の配列）
- pick_up/open_door の undo も対応

### 扉システム
- 特定のアイテムIDで開錠できる障害物
- 閉じた扉は move_forward をブロック
- 開いた扉は通過可能
- レベルデータで事前配置、`isOpen: false` で初期化

---

## 非機能要件

- **PC専用優先:** キーボード入力が必須のためPC優先
- **レスポンシブ対応:** 画面幅が狭い場合、縦並びレイアウトに切り替え
- **時間制限なし:** プレッシャーを与えない設計
- **音響:** BGM・効果音は将来実装
- **ローカルストレージ:** 学習記録は将来実装
- **アクセシビリティ:** フォントサイズ大きめ、コントラスト確保

---

## スコープ定義（現時点: Step 2 完了後）

### IN スコープ
- グリッド表示（サイズ可変）
- キャラクター（三角形矢印）描画
- ゴール（星マーク）描画
- 5コマンド（基本3 + コンテキスト2）
- 障害物（通過不可マス）
- アイテム（取得可能オブジェクト）
- 扉（アイテムで開錠可能な障害物）
- ローマ字タイピングエンジン（複数パターン対応）
- コマンドパレット（個別グレーアウト対応）
- スムーズアニメーション（移動・回転）
- ゴール到達でクリア表示
- リセット機能・Undo/Redo
- 8ステージのレベルデータ
- 写経モード（推奨コマンド自動提示）
- 難易度設定（やさしい / じごく）
- ユニットテスト

### OUT スコープ（将来）
- ペンコマンド（ペンをあげる/おろす）
- 複数歩移動（○ほすすむ）
- 自然言語入力
- 音響
- ローカルストレージ永続化
- タイピング統計

---

## 将来ステップ（概要）

| Step | 内容 |
|---|---|
| Step 3 | モードA（お絵かき）、ペンコマンド、お題データ、クリア判定 |
| Step 4 | 自然言語入力（ダミーLLMキーワードマッチング） |
| Step 5 | ローマ字ヒントUI、統計機能、ビジュアル強化 |
| Step 6+ | localStorage、マルチプレイヤー、バックエンド |

---

## アイデアメモ

正式な要件ではないが、将来検討したいアイデア。

### くりかえし × 掛け算

「n マス進む」や「n 回くりかえす」を導入することで、タイピング練習とプログラミング的思考に掛け算の概念を自然に絡められる可能性がある。

**候補パターン:**

**A. くりかえしコマンド（シンプル）**
- 「3かい まえにすすむ」→ 3マス進む
- 「3かい」という数字入力ステップを先に行い、続けて動詞コマンドを選ぶ 2ステップ入力
- 「3かい × 2ほ = 6マス」をビジュアルで見せると掛け算が自然に出てくる

**B. ループブロック（Scratch寄り）**
```
3かいくりかえす {
  まえにすすむ
  みぎをむく
}
```
- 正方形を描くには `4回 × (まえ + 曲がる)` が必要、という気づきがプログラミング的にも掛け算的にも自然
- Scratch のブロック概念に近く、その後の学習接続がスムーズ

**C. 掛け算の扉（ゲーム的）**
- 迷路の扉に「3×4=？」の問題が表示され、ローマ字で答えを打つと開く
- 純粋に算数ゲームとしての色が強い、完全に別の方向性

教育的・ゲーム的バランスの観点では **B（ループブロック）** が最も自然で、プログラミングの本質（抽象化・繰り返し）の体験にもつながるため有望。
